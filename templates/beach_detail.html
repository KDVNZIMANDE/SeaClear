{% extends "base.html" %}

{% block title %}
Beach Details
{% endblock %}

{% block extra_css %}
<!-- Link to custom beach CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/beach.css') }}">

<!-- Link to Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block content %}
<!-- Main container for the beach details and chat section -->
<div id="chat-section" class="container">
  <div class="layout">
    
    <!-- Left Column: Beach Details -->
    <div class="left-column">
      <div class="card">
        <div class="directions-button">
          <a href="#" class="directions-icon">
            Get Directions <i class="fa fa-location-arrow"></i> <!-- FontAwesome directions icon -->
          </a>
        </div>
        <!-- Beach Image -->
        <img src="{{ url_for('static', filename='images/' + beach.get('image', 'default_beach.jpg')) }}" alt="Beach Image">
        
        <!-- Favorite Pin Icon -->
        <div class="pin-favorite">
          <a href="#" class="favorite-pin" id="pinIcon">
            <i class="fa fa-thumbtack"></i> <!-- FontAwesome pin icon -->
          </a>
        </div>
        
        <!-- Card Content -->
        <div class="card-content">
          <h2>{{ beach.name }} (Cape Town)</h2>
          <!-- Status Indicator -->
          <div class="status">
            <i class="fa fa-swimmer"></i> SAFE
          </div>
        </div>
        
        <!-- Real-time Weather Information -->
        <div class="weather-info">
          <p><i class="fa fa-thermometer-half"></i> 20Â°C</p>
          <p><i class="fa fa-cloud"></i> Cloudy</p>
          <p><i class="fa fa-wind"></i> 7 m/s</p>
          <a
          href="{{ url_for('beach_detail', beach_id=beach.get('_id', '')) }}"
          class="btn btn-primary"
          >Weekend forecast ></a>
        </div>
      </div>
      
      <!-- Amenities Section -->
      <div class="amenities">
        <div class="amenity-box"><i class="fa fa-toilet"></i> Restrooms</div>
        <div class="amenity-box"><i class="fa fa-life-ring"></i> Lifeguard</div>
        <div class="amenity-box"><i class="fa fa-shower"></i> Showers</div>
        <div class="amenity-box"><i class="fa fa-swimming-pool"></i> Swimming Pools</div>
        <div class="amenity-box"><i class="fa fa-shield-alt"></i> Police Station</div>
        <div class="amenity-box"><i class="fa fa-bicycle"></i> Bike Rentals</div>
      </div>
    </div>
    
    <!-- Right Column: Community Chat -->
    <div class="right-column">
      <div class="chat-card">
        <!-- Chat Header -->
        <div class="chat-header">
          <h3>Community Chat <i class="fa fa-comments"></i></h3>
        </div>
        
        <!-- Scrollable Chat Messages -->
        <div class="chat-messages">
          {% for comment in comments %}
          <div class="message">
            <span class="author"><i class="fa fa-user-circle"></i> {{ comment.username }}</span>
            <span class="time text-muted float-right">{{ comment.timestamp }}</span>
            <p>
              {{ comment.content }}
            </p>
            <div class="message-buttons">
              <a href="{{ url_for('like', post_id=comment._id) }}" class="btn btn-like"><i class="fa fa-thumbs-up"></i> {{ comment.likes }}</a>
              <a class="btn btn-reply" data-message-id="{{ comment.id }}"><i class="fa fa-reply"></i>Reply</a>
              <button class="reply-btn" onclick="toggleReplies(2)">View Replies</button>
            </div>

            <div id="replies-2" class="replies" style="display: none; margin-left: 20px;">
              <div class="reply">
                  <span class="author"><i class="fa fa-user-circle"></i>Mark Lee</span>
                  <span class="time text-muted float-right">2024-09-08 13:05</span>
                  <p>This is a reply to the second message.</p>
                  <div class="message-buttons">
                    <a  class="btn btn-like"><i class="fa fa-thumbs-up"></i> {{ comment.likes }}</a>
                  </div>
              </div>
              <div class="reply">
                <span class="author"><i class="fa fa-user-circle"></i>Jane Smith</span>
                <span class="time text-muted float-right">2024-09-08 12:50</span>
                <p>This is a reply to the first message.</p>
                <div class="message-buttons">
                  <a  class="btn btn-like"><i class="fa fa-thumbs-up"></i> {{ comment.likes }}</a>
                </div>
              </div>
            </div>

            <div id="reply-form" class="reply-form" style="display: none;">
              <form class="send-message-form">
                <input type="hidden" name="reply_to_message_id" value="">
                <!-- Chat Input Container -->
                <div class="chat-input">
                  <!-- Emoji Picker Button -->
                  <a id="emoji-picker-bt" type="button" class="btn btn-light">
                      <i class="fa fa-smile"></i> <!-- Emoji icon -->
                  </a>

                  <div id="emoji-picker " class="emoji-picker">
                    <!-- Emoji list will be populated here -->
                  </div>
                  
                  <!-- Text Area -->
                  <textarea id="content1" name="content" class="form-control" rows="1" placeholder="Type a message..." required></textarea>
                  
                  <!-- Send Button -->
                  <button tsubmitype="" class="btn btn-primary">Send</button>
                  
                  <!-- Emoji Picker Container -->
                  
                </div>
              </form>
            </div>
            
          
            
          </div>
          {% endfor %}
        </div>
        
        <!-- Chat Input -->
        {% if current_user.is_authenticated %}
        <form method="POST" action="{{ url_for('post') }}" class="send-message-form">
          <input type="hidden" name="beach_id" value="{{ beach._id }}">
          <!-- Chat Input Container -->
          <div class="chat-input">
            <!-- Emoji Picker Button -->
            <a id="emoji-picker-btn" type="button" class="btn btn-light">
                <i class="fa fa-smile"></i> <!-- Emoji icon -->
            </a>

            <div id="emoji-picker" class="emoji-picker">
              <!-- Emoji list will be populated here -->
            </div>
            
            <!-- Text Area -->
            <textarea id="content" name="content" class="form-control" rows="1" placeholder="Type a message..." required></textarea>
            
            <!-- Send Button -->
            <button tsubmitype="" class="btn btn-primary">Send</button>
            
            <!-- Emoji Picker Container -->
            
          </div>

        </form>
        
        {% else %}
        <p>You must be logged in to send messages. <a href="{{ url_for('login') }}">Log in here</a>.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<!-- Water Quality Section -->
<div id="water-quality-section" class="container">
  <h3>Water Quality Information</h3>

  <!-- NowCast Data Table -->
  <div class="nowcast-table">
    <table id="data-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Enterococci count</th>
          <th>Rating</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <tr><td>Jul 19 2024</td><td>76</td><td>Good</td></tr>
        <tr><td>Jul 18 2024</td><td>126</td><td>Acceptable</td></tr>
        <tr><td>Jul 17 2024</td><td>53</td><td>Good</td></tr>
        <tr><td>Jul 16 2024</td><td>123</td><td>Acceptable</td></tr>
        <tr><td>Jul 15 2024</td><td>34</td><td>Good</td></tr>
        <tr><td>Jul 14 2024</td><td>180</td><td>Good</td></tr>
        <tr><td>Jul 13 2024</td><td>150</td><td>Good</td></tr>
        <tr><td>Jul 12 2024</td><td>42</td><td>Good</td></tr>
        <tr><td>Jul 11 2024</td><td>>150</td><td>Bad</td></tr>
        <tr><td>Jul 10 2024</td><td>>150</td><td>Bad</td></tr>
        <tr><td>Jul 09 2024</td><td>76</td><td>Good</td></tr>
        <tr><td>Jul 08 2024</td><td>58</td><td>Good</td></tr>
        <tr><td>Jul 19 2024</td><td>76</td><td>Good</td></tr>
        <tr><td>Jul 18 2024</td><td>126</td><td>Acceptable</td></tr>
        <tr><td>Jul 17 2024</td><td>53</td><td>Good</td></tr>
        <tr><td>Jul 16 2024</td><td>123</td><td>Acceptable</td></tr>
        <tr><td>Jul 15 2024</td><td>34</td><td>Good</td></tr>
        <tr><td>Jul 14 2024</td><td>180</td><td>bad</td></tr>
        <tr><td>Jul 13 2024</td><td>150</td><td>Good</td></tr>
        <tr><td>Jul 12 2024</td><td>42</td><td>Good</td></tr>
        <tr><td>Jul 11 2024</td><td>>150</td><td>Bad</td></tr>
        <tr><td>Jul 10 2024</td><td>>150</td><td>Bad</td></tr>
        <tr><td>Jul 09 2024</td><td>76</td><td>Good</td></tr>
        <tr><td>Jul 08 2024</td><td>58</td><td>Good</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  <div class="pagination-controls">
    <button id="prev-btn" disabled>Previous</button>
    <span id="page-info"></span>
    <button id="next-btn">Next</button>
  </div>
</div>


{% endblock %}

{% block extra_js %}
<!-- Include this script in your template -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Function to format date and time
    function formatDateTime(dateTimeString) {
      const date = new Date(dateTimeString);
      const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };
      return date.toLocaleString('en-US', options).replace(',', ''); // Remove the comma between date and time
    }
  
    // Apply formatting to all timestamps
    document.querySelectorAll('.time').forEach(function(element) {
      element.textContent = formatDateTime(element.textContent);
    });
  });
  </script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Function to scroll to the bottom of the chat messages container
    function scrollToBottom() {
      const chatMessages = document.querySelector('.chat-messages');
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  
    // Scroll to bottom on page load
    scrollToBottom();
  
  });
  </script>
  
<!-- Link to custom scripts -->
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
{% endblock %}
